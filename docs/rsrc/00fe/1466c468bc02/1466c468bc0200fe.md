自分で作った python 製 discordbot を、1日1回定期実行させたい

# リポジトリ取得から venv 構築

リポジトリとってきて、 venv を構築する。

ただし venv はデフォルトで入っていないので、入れる必要があった

```sh
$ sudo apt install python3.12-venv
...
$ cd (path)
$ python3 -m venv env
$ source env/bin/activate
$ pip install -r pip-requirements.txt
```

# スクリプトを作る

venv に入ってから `python -m ucbot` をたたくスクリプトを claude に書いてもらった

```sh
#!/bin/bash

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Change to the script directory
cd "$SCRIPT_DIR" || exit 1

# Activate virtual environment
source env/bin/activate || exit 1

# Run the bot
python -m ucbot

# Exit status of the python command
exit $?
```

そして executable 権限を与える

```sh
$ chmod +x /PATH/TO/REPO/execute.sh
```

# cron にジョブを追加する

`crontab` コマンドでファイルを編集する。ユーザー neko として実行したいので `-u neko` を指定した。

初回起動時のみエディタを聞かれるらしい。すみません、自分は nano がちょっとだけ触れるので、 nano を選びました

```sh
$ crontab -u neko -e
no crontab for neko - using an empty one

Select an editor.  To change later, run 'select-editor'.
  1. /bin/nano        <---- easiest
  2. /usr/bin/vim.basic
  3. /usr/bin/vim.tiny
  4. /bin/ed

Choose 1-4 [1]: 
crontab: installing new crontab
```

毎日13時に実行するために以下の行を追加：

```txt
0 13 * * * /PATH/TO/REPO/execute.sh >> /PATH/TO/REPO/logs/ucbot.log 2>&1
```

先頭から、分、時、日、月、曜日を指定し、 "*" を指定すれば条件としない。

ログをリポジトリの中に出力させるようにしているが、これは一時的で、あとで /var/log に変更したいが、SDカードへ書き出したくはないので、後々対策します。

リダイレクトしないと mail コマンドによってメールとして送信されるとか。

保存して確認：

```sh
$ crontab -u neko -l
```

先ほど記述したものが表示される

# 試しに実行してみる

しかし探してみたが cron には手動実行がないらしい。この設定ファイルの書き方であればそれもそうか、という感じ。

neko ユーザーのホームディレクトリから呼び出しで実行できるかだけ見ておく。